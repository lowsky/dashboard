machine:
  node:
    version: 8
  services:
    - docker

dependencies:
  pre:
    - echo building ... dashboard/${CIRCLE_BRANCH}:$CIRCLE_SHA1 .
    - env
  post:
    - docker build -t dashboard .

test:
  override:
    - npm run test:circle
  post:
    - docker run -d -p 3000:3000 dashboard; cont=$(docker ps -ql) ; sleep 5 ; wget -T 30 --tries=10 -S -v --retry-connrefused http://localhost:3000 -O- ; docker logs $cont
